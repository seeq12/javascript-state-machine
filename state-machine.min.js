!function(){var t={VERSION:"2.3.6",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(n,e){var r="string"==typeof n.initial?{state:n.initial}:n.initial,a=n.terminal||n["final"],i=e||n.target||{},o=n.events||[],s=n.callbacks||{},u={},f={},c=function(n){var e=n.from instanceof Array?n.from:n.from?[n.from]:[t.WILDCARD];u[n.name]=u[n.name]||{};for(var r=0;r<e.length;r++)f[e[r]]=f[e[r]]||[],f[e[r]].push(n.name),u[n.name][e[r]]=n.to||e[r]};r&&(r.event=r.event||"startup",c({name:r.event,from:"none",to:r.state}));for(var l=0;l<o.length;l++)c(o[l]);for(var v in u)u.hasOwnProperty(v)&&(i[v]=t.buildEvent(v,u[v]));for(var h in s)s.hasOwnProperty(h)&&(i[h]=s[h]);return i.current="none",i.is=function(t){return t instanceof Array?t.indexOf(this.current)>=0:this.current===t},i.can=function(n){return!this.transition&&(u[n].hasOwnProperty(this.current)||u[n].hasOwnProperty(t.WILDCARD))},i.cannot=function(t){return!this.can(t)},i.transitions=function(){return f[this.current]},i.isFinished=function(){return this.is(a)},i.error=n.error||function(t,n,e,r,a,i,o){throw o||i},i.sameStateTransitions=!!n.sameStateTransitions,r&&!r.defer&&i[r.event](),i},doCallback:function(n,e,r,a,i,o){if(e)try{return e.apply(n,[r,a,i].concat(o))}catch(s){return n.error(r,a,i,o,t.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",s)}},beforeAnyEvent:function(n,e,r,a,i){return t.doCallback(n,n.onbeforeevent,e,r,a,i)},afterAnyEvent:function(n,e,r,a,i){return t.doCallback(n,n.onafterevent||n.onevent,e,r,a,i)},leaveAnyState:function(n,e,r,a,i){return t.doCallback(n,n.onleavestate,e,r,a,i)},enterAnyState:function(n,e,r,a,i){return t.doCallback(n,n.onenterstate||n.onstate,e,r,a,i)},changeState:function(n,e,r,a,i){return t.doCallback(n,n.onchangestate,e,r,a,i)},beforeThisEvent:function(n,e,r,a,i){return t.doCallback(n,n["onbefore"+e],e,r,a,i)},afterThisEvent:function(n,e,r,a,i){return t.doCallback(n,n["onafter"+e]||n["on"+e],e,r,a,i)},leaveThisState:function(n,e,r,a,i){return t.doCallback(n,n["onleave"+r],e,r,a,i)},enterThisState:function(n,e,r,a,i){return t.doCallback(n,n["onenter"+a]||n["on"+a],e,r,a,i)},beforeEvent:function(n,e,r,a,i){return!1===t.beforeThisEvent(n,e,r,a,i)||!1===t.beforeAnyEvent(n,e,r,a,i)?!1:void 0},afterEvent:function(n,e,r,a,i){t.afterThisEvent(n,e,r,a,i),t.afterAnyEvent(n,e,r,a,i)},leaveState:function(n,e,r,a,i){var o=t.leaveThisState(n,e,r,a,i),s=t.leaveAnyState(n,e,r,a,i);return!1===o||!1===s?!1:t.ASYNC===o||t.ASYNC===s?t.ASYNC:void 0},enterState:function(n,e,r,a,i){t.enterThisState(n,e,r,a,i),t.enterAnyState(n,e,r,a,i)},buildEvent:function(n,e){return function(){var r=this,a=this.current,i=e[a]||e[t.WILDCARD]||a,o=Array.prototype.slice.call(arguments);if(this.transition)return this.error(n,a,i,o,t.Error.PENDING_TRANSITION,"event "+n+" inappropriate because previous transition did not complete");if(this.cannot(n))return this.error(n,a,i,o,t.Error.INVALID_TRANSITION,"event "+n+" inappropriate in current state "+this.current);if(!1===t.beforeEvent(this,n,a,i,o))return t.Result.CANCELLED;if(a===i&&!this.sameStateTransitions)return t.afterEvent(this,n,a,i,o),t.Result.NOTRANSITION;this.transition=function(){return r.transition=null,r.current=i,t.enterState(r,n,a,i,o),t.changeState(r,n,a,i,o),t.afterEvent(r,n,a,i,o),t.Result.SUCCEEDED},this.transition.cancel=function(){r.transition=null,t.afterEvent(r,n,a,i,o)};var s=t.leaveState(this,n,a,i,o);return!1===s?(this.transition=null,t.Result.CANCELLED):t.ASYNC===s?t.Result.PENDING:this.transition?this.transition():void 0}}};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.StateMachine=t):"function"==typeof define&&define.amd?define(function(n){return t}):"undefined"!=typeof window?window.StateMachine=t:"undefined"!=typeof self&&(self.StateMachine=t)}();